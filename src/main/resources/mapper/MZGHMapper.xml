<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.magneto.his.mapper.MZGHMapper">
    <insert id="insertBRXX">
        insert into yy_brxx values (default ,#{brxx_name},#{brxx_age} , #{brxx_sex},#{brxx_phone},#{brxx_birth},#{brxx_address},#{brxx_idCard} )
    </insert>


    <select id="getCardCode" resultType="java.lang.Integer">
      select max(CardCode) from yy_kdjb
    </select>


    <resultMap id="brxxMap" type="com.magneto.his.domain.YY_BRXX">
        <result property="brxx_name" column="brxx_name"></result>
        <result property="brxx_sex" column="brxx_sex"></result>
        <result property="brxx_phone" column="brxx_phone"></result>
        <result property="brxx_birth" column="brxx_birth"></result>
        <result property="brxx_address" column="brxx_address"></result>
        <result property="brxx_idCard" column="brxx_idCard"></result>
        <association property="yy_kdjb" javaType="com.magneto.his.domain.YY_KDJB">
            <id property="cardCode" column="cardcode"></id>
        </association>
    </resultMap>


    <insert id="insert">
      insert into yy_brxx values (default ,#{brxx_name},#{brxx_age} , #{brxx_sex},#{brxx_phone},#{brxx_birth},#{brxx_address},#{brxx_idCard} )
    </insert>


    <select id="selectByParams" resultMap="brxxMap">
      select cardCode,brxx_name,brxx_sex,brxx_phone,brxx_birth,brxx_address from yy_brxx a join yy_kdjb b on a.brxx_id = b.brxx_id
      <where>
          <if test="Brxx_Card != null and Brxx_Card != ''">
              and cardCode like concat("%",#{Brxx_Card} ,"%")
          </if>
          <if test="Brxx_Name != null and Brxx_Name != ''">
              and brxx_name like concat("%",#{Brxx_Name} ,"%")
          </if>
          <if test="Brxx_Phone != null and Brxx_Phone != ''">
              and Brxx_Phone like concat("%",#{Brxx_Phone} ,"%")
          </if>
          <if test="Card_End_registrationTime != null and Card_End_registrationTime != '' and Card_Start_registrationTime != null and Card_Start_registrationTime != '' ">
              and registrationTime between #{Card_Start_registrationTime} and #{Card_End_registrationTime}
          </if>
          <if test="Brxx_End_Birth != null and Brxx_End_Birth != '' and Brxx_Start_Birth != null and Brxx_Start_Birth != '' ">
              and brxx_birth between #{Brxx_Start_Birth} and #{Brxx_End_Birth}
          </if>
      </where>
        order by cardCode desc
    </select>


    <resultMap id="brxxMap2" type="com.magneto.his.domain.YY_BRXX">
        <id property="brxx_id" column="brxx_id"></id>
        <result property="brxx_name" column="brxx_name"></result>
        <result property="brxx_sex" column="brxx_sex"></result>
        <result property="brxx_phone" column="brxx_phone"></result>
        <result property="brxx_idCard" column="brxx_idCard"></result>
        <result property="brxx_age" column="brxx_age"></result>
        <association property="yy_kdjb" javaType="com.magneto.his.domain.YY_KDJB">
            <id property="cardCode" column="cardcode"></id>
        </association>
    </resultMap>
    <select id="selectOneBrxx" resultMap="brxxMap2">
        select CardCode cardCode,a.brxx_id,brxx_name,brxx_phone,brxx_sex,brxx_idCard,brxx_age from yy_brxx a left join yy_kdjb b on a.brxx_id = b.brxx_id
        <where>
            <if test="brxx_idCard != null and brxx_idCard != ''">
                and brxx_idCard = #{brxx_idCard}
            </if>
            <if test="cardCode != null and cardCode != 0">
                and cardCode = #{cardCode}
            </if>
        </where>
    </select>

    <select id="MZGHDJ" statementType="CALLABLE" resultType="java.lang.Integer">
        select fun_mzghdj(#{brxx_id},#{ghks},#{ghjb},#{sfy})
    </select>


    <select id="getMoney" resultType="java.lang.Double">
        select item_price from jc_hsitem where item_id = #{level}
    </select>


    <insert id="insertHJB">
        insert into mz_hjb values(default,#{brxx_id},#{ghxx_id},default,#{hjy},#{ysdm},#{ksdm},#{item_id},#{je},1)
    </insert>


    <select id="getGHXXList" resultType="com.magneto.his.domain.MZGH_GHDJPOJO">
            select c.CardCode cardCode ,b.brxx_name,fun_getDeptName(a.ksdm) deptName,a.je from mz_hjb a left join yy_brxx b on a.brxx_id = b.brxx_id left join yy_kdjb c on a.brxx_id = c.brxx_id order by a.hjsj desc
    </select>


</mapper>